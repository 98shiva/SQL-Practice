-- Retrieve all orders along with the customer details.
select o.*,c.first_name
from orders o   join customers c
on o.customer_id = c.customer_id;

-- Show all customers and their orders, including customers who haven’t placed any orders.
select c.first_name,o.order_id
from   customers c left join orders o  
on o.customer_id = c.customer_id;

-- Display all orders and their customer information, including orders that don’t have a matching customer record.
select o.* , c.* 
from orders o left join customers c  
on o.customer_id = c.customer_id;

-- List all possible combinations of customers and products.
select concat(c.first_name,"",c.last_name) as full_name , p.product_id,p.product_name	
from customers c cross join products p;

-- Retrieve order details along with product names.
select od.*,p.product_name
from products p join order_details od
on p.product_id = od.product_id;

-- Show all products and the orders they appear in, including products that have never been ordered.
select p.*,o.order_id
from products p left  join order_Details od
on p.product_id = od.product_id 
left join orders o 
on o.order_id = od.order_id;

-- Return customer names and product names for each order placed.
select concat(c.first_name,"",c.last_name) as full_name , p.product_name,o.order_id
from customers c  join orders o 
using (customer_id)
join order_details od  
using (order_id)
join products p
using (product_id);

-- Find all orders with their shipping address and the product category for each item in the order.
select o.order_id,o.shipping_address, p.category
from orders o join order_details od  
using (order_id)
join products p 
using(product_id);

-- Display all returns with their corresponding order details and product information.
SELECT 
    r.return_id,
    r.return_date,
    r.reason,
    r.refund_status,

    od.order_detail_id,
    od.order_id,
    od.quantity,
    od.unit_price,
    od.total_price,

    p.product_id,
    p.product_name,
    p.category,
    p.brand
FROM returns r
JOIN order_details od
    ON r.order_detail_id = od.order_detail_id
JOIN products p
    ON od.product_id = p.product_id;

-- For 2025, list customers with their orders and sort the results by the most recent order date.

select c.first_name, o.* 
from customers c join orders o 
using (customer_id) 
where year(o.order_date) = 2025
order  by o.order_date desc; 

-- For each customer, show total orders and total quantity ordered
select concat(c.first_name,"",c.last_name) full_name, count(distinct o.order_id) total_order , sum(od.quantity) total_quantity
from customers c join orders o 
using (customer_id)
join order_details od
using (order_id)
group by full_name;

-- For each product, show total units sold and total revenue; include products that have never been ordered.
select p.product_name , sum(od.quantity) as total_unit_sold , 
sum(od.unit_price*od.quantity) as gross_revenue , 
sum(od.quantity*od.unit_price*(1-od.discount_percent/100)) total_revenue
from products p left join order_details od
using (product_id)
group by p.product_name ;

-- For each month of a given year, show total orders and total returned items; return only months where the return rate exceeds a chosen percentage.
SELECT 
    DATE_FORMAT(o.order_date, '%Y-%m') AS month,
    COUNT(DISTINCT o.order_id) AS total_orders,
    COUNT(r.return_id) AS total_returns,
    SUM(od.quantity) AS total_quantity,
    (COUNT(r.return_id) / SUM(od.quantity)) * 100 AS return_rate
FROM orders o
JOIN order_details od 
    ON o.order_id = od.order_id
LEFT JOIN returns r 
    ON od.order_detail_id = r.order_detail_id
WHERE YEAR(o.order_date) = 2025
GROUP BY month
HAVING return_rate > 10
ORDER BY month;

-- For each customer, show their first-ever order date and the number of products in that first order.

select customer_id,first_name,order_date ,sum(quantity) from 
(select c.customer_id,c.first_name , o.order_date , od.quantity,
dense_rank()over(partition by c.customer_id order by o.order_date) rnk
from customers c join orders o
on c.customer_id = o.customer_id
join order_details od  
on od.order_id = o.order_id) as first_date
where rnk =1 
group by customer_id,first_name,order_date ;


-- List orders placed on weekends with customer names and product categories, sorted by order date and category.

select concat(c.first_name,"",c.last_name) full_name , 
p.category,dayname(o.order_date) day_name
from customers c join orders o 
on c.customer_id = o.customer_id 
join order_details od  
on od.order_id = o.order_id 
join products p 
on p.product_id = od.product_id
where  dayname(o.order_date) in ("Saturday","Sunday") 
order by o.order_date , p.category;






